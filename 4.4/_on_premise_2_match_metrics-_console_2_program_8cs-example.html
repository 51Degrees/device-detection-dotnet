<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection .NET: OnPremise/MatchMetrics-Console/Program.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Device Detection .NET
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">Device detection services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_on_premise_2_match_metrics-_console_2_program_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">OnPremise/MatchMetrics-Console/Program.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>The example illustrates the various metrics that can be obtained about the device detection process, for example, the degree of certainty about the result. Running the example outputs those properties and values..</p>
<p>The example also illustrates controlling properties that are returned from the detection process - reducing the number of components required to return the properties requested reduces the overall time taken.</p>
<p>There is a <a href="https://51degrees.com/documentation/_device_detection__hash.html#DeviceDetection_Hash_DataSetProduction_Performance">discussion</a> of metrics and controlling performance on our web site. See also the <a href="https://51degrees.com/documentation/_device_detection__features__performance_options.html">performance options</a> page.</p>
<p>This example is available in full on <a href="https://github.com/51Degrees/device-detection-dotnet/blob/master/Examples/OnPremise/MatchMetrics-Console/Program.cs">GitHub</a>. </p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_hash.html">Hash</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_hash_1_1_engine.html">Engine</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_hash_1_1_engine_1_1_on_premise.html">OnPremise</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_hash_1_1_engine_1_1_on_premise_1_1_flow_elements.html">FlowElements</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Exceptions;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.FiftyOne.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Collections.Generic;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.IO;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Linq;</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics.html">FiftyOne.DeviceDetection.Examples.OnPremise.MatchMetrics</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Program</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Example : ExampleBase</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">public</span> DeviceDetectionPipelineBuilder <a name="a0"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics_1_1_program_1_1_example.html#a464d91859f68f8ee38c2cdecaf008e3c">PipelineBuilder</a> { <span class="c-code__keyword">get</span>; <span class="c-code__keyword">private</span> <span class="c-code__keyword">set</span>; }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> ILogger&lt;Example&gt; Logger { <span class="c-code__keyword">get</span>; <span class="c-code__keyword">private</span> <span class="c-code__keyword">set</span>; }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <a name="a1"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics_1_1_program_1_1_example.html#af53dbdae321646d771481f21b69e3052">Example</a>(DeviceDetectionPipelineBuilder pipelineBuilder,</div><div class="c-code__line">                ILogger&lt;Example&gt; logger)</div><div class="c-code__line">            {</div><div class="c-code__line">                <a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics_1_1_program_1_1_example.html#a464d91859f68f8ee38c2cdecaf008e3c">PipelineBuilder</a> = pipelineBuilder;</div><div class="c-code__line">                Logger = logger;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> <a name="a2"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics_1_1_program_1_1_example.html#ade998295be159490ebe34036d5d08995">Run</a>(<span class="c-code__keywordtype">string</span> dataFile, </div><div class="c-code__line">                IEnumerable&lt;Dictionary&lt;string, object&gt;&gt; evidenceList, TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                dataFile = CheckDataFile(dataFile);</div><div class="c-code__line">                Logger.LogInformation($<span class="c-code__stringliteral">&quot;Constructing pipeline from file {dataFile}&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// Build the device detection pipeline  and pass in the desired settings to configure</span></div><div class="c-code__line">                <span class="c-code__comment">// automatic updates.</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var pipeline = <a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_match_metrics_1_1_program_1_1_example.html#a464d91859f68f8ee38c2cdecaf008e3c">PipelineBuilder</a></div><div class="c-code__line">                    <span class="c-code__comment">// We pass a null license key as we don&#39;t need to do any data file updates.</span></div><div class="c-code__line">                    .<a name="a3"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_pipeline_builder.html#a9385d426782d4521a0f15877c9c19ab8">UseOnPremise</a>(dataFile, <span class="c-code__keyword">null</span>, <span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// Disable share usage for this example.</span></div><div class="c-code__line">                    .<a name="a4"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#ac07ce22d9fd0a0a4cc6a8a505de73a1e">SetShareUsage</a>(<span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// Prefer low memory profile where all data streamed from disk on-demand.</span></div><div class="c-code__line">                    .<a name="a5"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a1156ed2683a30e49c6e81e894cb7e65e">SetPerformanceProfile</a>(Pipeline.Engines.PerformanceProfiles.LowMemory)</div><div class="c-code__line">                    <span class="c-code__comment">// Disable all data file update mechanisms</span></div><div class="c-code__line">                    .<a name="a6"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#aee59d01daf4934fb9b793cae879a3cc0">SetDataUpdateOnStartUp</a>(<span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    .<a name="a7"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#aa4ba15d3d8ca2c4ff3e5874426ffc01e">SetAutoUpdate</a>(<span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    .<a name="a8"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#aace4e9dfafc668c70659fc1c67906f78">SetDataFileSystemWatcher</a>(<span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// You can improve matching performance by specifying only those</span></div><div class="c-code__line">                    <span class="c-code__comment">// properties you wish to use. If you don&#39;t specify any properties</span></div><div class="c-code__line">                    <span class="c-code__comment">// you will get all those available in the data file tier that</span></div><div class="c-code__line">                    <span class="c-code__comment">// you have used. The free &quot;Lite&quot; tier contains fewer than 20.</span></div><div class="c-code__line">                    <span class="c-code__comment">// Since we are specifying properties here, we will only see</span></div><div class="c-code__line">                    <span class="c-code__comment">// those properties, along with the match metric properties</span></div><div class="c-code__line">                    <span class="c-code__comment">// in the output.</span></div><div class="c-code__line">                    .<a name="a9"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a1fc6354fcdf1e5784f2a02a86be01491">SetProperty</a>(<span class="c-code__stringliteral">&quot;IsMobile&quot;</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// Uncomment BrowserName to include Browser component profile ID</span></div><div class="c-code__line">                    <span class="c-code__comment">// in the device ID value.</span></div><div class="c-code__line">                    <span class="c-code__comment">//.SetProperty(&quot;BrowserName&quot;)</span></div><div class="c-code__line">                    <span class="c-code__comment">// If using the full on-premise data file this property will be</span></div><div class="c-code__line">                    <span class="c-code__comment">// present in the data file. See https://51degrees.com/pricing</span></div><div class="c-code__line">                    .<a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a1fc6354fcdf1e5784f2a02a86be01491">SetProperty</a>(<span class="c-code__stringliteral">&quot;HardwareName&quot;</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// Only use the predictive graph to better handle variances</span></div><div class="c-code__line">                    <span class="c-code__comment">// between the training data and the target User-Agent string.</span></div><div class="c-code__line">                    <span class="c-code__comment">// For a more detailed description of the differences between</span></div><div class="c-code__line">                    <span class="c-code__comment">// performance and predictive, see</span></div><div class="c-code__line">                    <span class="c-code__comment">// https://51degrees.com/documentation/_device_detection__hash.html#DeviceDetection_Hash_DataSetProduction_Performance</span></div><div class="c-code__line">                    .<a name="a10"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a72ec5cf1c887b48609d0cc8578810bb4">SetUsePredictiveGraph</a>(<span class="c-code__keyword">true</span>)</div><div class="c-code__line">                    .<a name="a11"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a92c42b1344286fbd92c507e33018d235">SetUsePerformanceGraph</a>(<span class="c-code__keyword">false</span>)</div><div class="c-code__line">                    <span class="c-code__comment">// build the pipeline</span></div><div class="c-code__line">                    .<a name="a12"></a><a class="code" href="class_fifty_one_1_1_device_detection_1_1_device_detection_on_premise_pipeline_builder.html#a7bcf8506fc3720bccf1fa261a10a3312">Build</a>())</div><div class="c-code__line">                {</div><div class="c-code__line">                    ExampleUtils.CheckDataFile(pipeline, Logger);</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__keywordflow">foreach</span> (var evidenceValues <span class="c-code__keywordflow">in</span> evidenceList)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__comment">// A using block MUST be used for the FlowData instance.</span></div><div class="c-code__line">                        <span class="c-code__comment">// This ensures that native resources created by the device detection engine</span></div><div class="c-code__line">                        <span class="c-code__comment">// are freed.</span></div><div class="c-code__line">                        <span class="c-code__keyword">using</span> (var data = pipeline.CreateFlowData())</div><div class="c-code__line">                        {</div><div class="c-code__line">                            <span class="c-code__comment">// Process a single evidence to retrieve the values</span></div><div class="c-code__line">                            <span class="c-code__comment">// associated with the user-agent and other evidence such as sec-ch-* for the</span></div><div class="c-code__line">                            <span class="c-code__comment">// selected properties.</span></div><div class="c-code__line">                            data.AddEvidence(evidenceValues)</div><div class="c-code__line">                                .Process();</div><div class="c-code__line"></div><div class="c-code__line">                            var device = data.Get&lt;IDeviceData&gt;();</div><div class="c-code__line"></div><div class="c-code__line">                            output.WriteLine(<span class="c-code__stringliteral">&quot;--- Compare evidence with what was matched ---\n&quot;</span>);</div><div class="c-code__line">                            output.WriteLine(<span class="c-code__stringliteral">&quot;Evidence&quot;</span>);</div><div class="c-code__line">                            <span class="c-code__comment">// output the evidence in reverse value length order</span></div><div class="c-code__line">                            evidenceValues.OrderBy(e =&gt; e.Value.ToString().Length)</div><div class="c-code__line">                                .ToList()</div><div class="c-code__line">                                .ForEach(e =&gt; output.WriteLine($<span class="c-code__stringliteral">&quot;\t{e.Key.PadRight(34)}: {e.Value}&quot;</span>));</div><div class="c-code__line">                            <span class="c-code__comment">// Obtain the matched User-Agents: the matched substrings in the</span></div><div class="c-code__line">                            <span class="c-code__comment">// User-Agents are separated with underscores - output in forward length order.</span></div><div class="c-code__line">                            output.WriteLine(<span class="c-code__stringliteral">&quot;Matches&quot;</span>);</div><div class="c-code__line">                            device.UserAgents.Value.OrderByDescending(u =&gt; u.Length)</div><div class="c-code__line">                                .ToList()</div><div class="c-code__line">                                .ForEach(u =&gt; output.WriteLine($<span class="c-code__stringliteral">&quot;\t{&quot;</span>Matched Chars<span class="c-code__stringliteral">&quot;.PadRight(34)}: {u}&quot;</span>));</div><div class="c-code__line"></div><div class="c-code__line">                            output.WriteLine();</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line">                            output.WriteLine(<span class="c-code__stringliteral">&quot;--- Listing all available properties, by component, by property &quot;</span> +</div><div class="c-code__line">                                    <span class="c-code__stringliteral">&quot;name ---&quot;</span>);</div><div class="c-code__line">                            output.WriteLine(<span class="c-code__stringliteral">&quot;For a discussion of what the match properties mean, see: &quot;</span> +</div><div class="c-code__line">                                    <span class="c-code__stringliteral">&quot;https://51degrees.com/documentation/_device_detection__hash&quot;</span> +</div><div class="c-code__line">                                    <span class="c-code__stringliteral">&quot;.html#DeviceDetection_Hash_DataSetProduction_Performance\n&quot;</span>);</div><div class="c-code__line">                            </div><div class="c-code__line">                            <span class="c-code__comment">// get the properties available from the DeviceDetection engine</span></div><div class="c-code__line">                            <span class="c-code__comment">// which has the key &quot;device&quot;. For the sake of illustration we will</span></div><div class="c-code__line">                            <span class="c-code__comment">// retrieve it indirectly.</span></div><div class="c-code__line">                            var hashEngineElementKey = pipeline</div><div class="c-code__line">                                .GetElement&lt;DeviceDetectionHashEngine&gt;().ElementDataKey;</div><div class="c-code__line"></div><div class="c-code__line">                            <span class="c-code__comment">// retrieve the available properties from the hash engine. The properties</span></div><div class="c-code__line">                            <span class="c-code__comment">// available depends on</span></div><div class="c-code__line">                            <span class="c-code__comment">// a) the use of setProperty() in the builder (see above)</span></div><div class="c-code__line">                            <span class="c-code__comment">// which controls which properties will be extracted, and also affects</span></div><div class="c-code__line">                            <span class="c-code__comment">// the performance of extraction</span></div><div class="c-code__line">                            <span class="c-code__comment">// b) the tier of data file being used. The Lite data file contains fewer</span></div><div class="c-code__line">                            <span class="c-code__comment">// than 20 of the &gt;200 available properties</span></div><div class="c-code__line">                            pipeline.ElementAvailableProperties.TryGetValue(</div><div class="c-code__line">                                hashEngineElementKey, out var availableProperties);</div><div class="c-code__line"></div><div class="c-code__line">                            <span class="c-code__comment">// create a Map keyed on the component name of the properties available</span></div><div class="c-code__line">                            <span class="c-code__comment">// components being hardware, browser, OS and Crawler.</span></div><div class="c-code__line">                            <span class="c-code__comment">// Match metric properties are not allocated to a component, so we will</span></div><div class="c-code__line">                            <span class="c-code__comment">// add a key &quot;MatchMetric&quot;</span></div><div class="c-code__line">                            var componentMap = availableProperties</div><div class="c-code__line">                                .Select(p =&gt; p.Value as IFiftyOneAspectPropertyMetaData)</div><div class="c-code__line">                                <span class="c-code__comment">// We&#39;ve already handled the matched user agents property above.</span></div><div class="c-code__line">                                .Where(p =&gt; p != <span class="c-code__keyword">null</span> &amp;&amp; p.Name != <span class="c-code__stringliteral">&quot;UserAgents&quot;</span>)</div><div class="c-code__line">                                .GroupBy(p =&gt; p.Component?.Name ?? <span class="c-code__stringliteral">&quot;MatchMetric&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">                            <span class="c-code__comment">// iterate the map created above</span></div><div class="c-code__line">                            componentMap.ToList().ForEach(group =&gt;</div><div class="c-code__line">                            {</div><div class="c-code__line">                                output.WriteLine(group.Key);</div><div class="c-code__line">                                <span class="c-code__keywordflow">foreach</span> (var entry <span class="c-code__keywordflow">in</span> group)</div><div class="c-code__line">                                {</div><div class="c-code__line">                                    <span class="c-code__comment">// while we get the available properties and their metadata</span></div><div class="c-code__line">                                    <span class="c-code__comment">// from the pipeline ...</span></div><div class="c-code__line">                                    <span class="c-code__keywordtype">string</span> propertyName = entry.Name;</div><div class="c-code__line">                                    <span class="c-code__keywordtype">string</span> propertyDescription = entry.Description;</div><div class="c-code__line">                                    <span class="c-code__comment">// ... we get the values for the last detection from flowData</span></div><div class="c-code__line">                                    <span class="c-code__keywordtype">object</span> value = device[entry.Name];</div><div class="c-code__line"></div><div class="c-code__line">                                    <span class="c-code__comment">// output property names, values and descriptions. Some property</span></div><div class="c-code__line">                                    <span class="c-code__comment">// values are lists so we need to handle those differently</span></div><div class="c-code__line">                                    <span class="c-code__keywordflow">if</span> (value is IAspectPropertyValue&lt;IReadOnlyList&lt;string&gt;&gt; listValue)</div><div class="c-code__line">                                    {</div><div class="c-code__line">                                        <span class="c-code__keywordflow">if</span> (listValue.HasValue)</div><div class="c-code__line">                                        {</div><div class="c-code__line">                                            output.WriteLine($<span class="c-code__stringliteral">&quot;\t{propertyName.PadRight(24)}: &quot;</span> +</div><div class="c-code__line">                                                $<span class="c-code__stringliteral">&quot;{listValue.Value.Count} Values&quot;</span>);</div><div class="c-code__line">                                            <span class="c-code__keywordflow">foreach</span> (var listItem <span class="c-code__keywordflow">in</span> listValue.Value)</div><div class="c-code__line">                                            {</div><div class="c-code__line">                                                output.WriteLine($<span class="c-code__stringliteral">&quot;\t\t{&quot;</span><span class="c-code__stringliteral">&quot;.PadRight(20)}: {listItem}&quot;</span>);</div><div class="c-code__line">                                            }</div><div class="c-code__line">                                        }</div><div class="c-code__line">                                        <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                                        {</div><div class="c-code__line">                                            output.WriteLine($<span class="c-code__stringliteral">&quot;\t{propertyName.PadRight(24)}: &quot;</span> +</div><div class="c-code__line">                                                $<span class="c-code__stringliteral">&quot;No value ({listValue.NoValueMessage})&quot;</span>);</div><div class="c-code__line">                                        }</div><div class="c-code__line">                                    }</div><div class="c-code__line">                                    <span class="c-code__keywordflow">else</span> <span class="c-code__keywordflow">if</span> (value is IAspectPropertyValue apv)</div><div class="c-code__line">                                    {</div><div class="c-code__line">                                        output.WriteLine($<span class="c-code__stringliteral">&quot;\t{propertyName.PadRight(24)}: &quot;</span> +</div><div class="c-code__line">                                            $<span class="c-code__stringliteral">&quot;{(apv.HasValue ? apv.Value.ToString() : apv.NoValueMessage)}&quot;</span>);</div><div class="c-code__line">                                    }</div><div class="c-code__line">                                    <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                                    {</div><div class="c-code__line">                                        output.WriteLine($<span class="c-code__stringliteral">&quot;\t{propertyName.PadRight(24)}: &quot;</span> +</div><div class="c-code__line">                                            $<span class="c-code__stringliteral">&quot;UNHANDLED TYPE &#39;{value.GetType().Name}&#39;&quot;</span>);</div><div class="c-code__line">                                    }</div><div class="c-code__line">                                    output.WriteLine($<span class="c-code__stringliteral">&quot;\t\t{propertyDescription}&quot;</span>);</div><div class="c-code__line">                                }</div><div class="c-code__line">                            });</div><div class="c-code__line"></div><div class="c-code__line">                            output.WriteLine();</div><div class="c-code__line"></div><div class="c-code__line">                        }</div><div class="c-code__line">                    }</div><div class="c-code__line"></div><div class="c-code__line">                    Logger.LogInformation(<span class="c-code__stringliteral">&quot;Finished Example&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line"></div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">string</span> CheckDataFile(<span class="c-code__keywordtype">string</span> dataFile)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// No filename specified use the default</span></div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (dataFile == <span class="c-code__keyword">null</span>)</div><div class="c-code__line">                {</div><div class="c-code__line">                    dataFile = Constants.LITE_HASH_DATA_FILE_NAME;</div><div class="c-code__line">                    Logger.LogWarning($<span class="c-code__stringliteral">&quot;No filename specified. Using default &#39;{dataFile}&#39;&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__comment">// Work out where the data file is if we don&#39;t have an absolute path.</span></div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (dataFile != <span class="c-code__keyword">null</span> &amp;&amp; Path.IsPathRooted(dataFile) == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">                {</div><div class="c-code__line">                    dataFile = ExampleUtils.FindFile(dataFile);</div><div class="c-code__line">                }</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__keywordflow">if</span>(dataFile == <span class="c-code__keyword">null</span> || File.Exists(dataFile) == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">                {</div><div class="c-code__line">                    Logger.LogError(<span class="c-code__stringliteral">&quot;Failed to find a device detection data file. &quot;</span> +</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;If using the default &#39;lite&#39; data file, make sure that git lfs is &quot;</span> +</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;installed and that the device-detection-data submodule has been &quot;</span> +</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;updated by running `git submodule update --recursive`.&quot;</span>);</div><div class="c-code__line">                    <span class="c-code__keywordflow">throw</span> <span class="c-code__keyword">new</span> PipelineConfigurationException($<span class="c-code__stringliteral">&quot;Data file &#39;{dataFile}&#39; not found&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__keywordflow">return</span> dataFile;</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> Main(<span class="c-code__keywordtype">string</span>[] args)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Use the supplied path for the data file or find the lite file that is included</span></div><div class="c-code__line">            <span class="c-code__comment">// in the repository.</span></div><div class="c-code__line">            var dataFile = args.Length &gt; 0 ? args[0] : <span class="c-code__keyword">null</span>;</div><div class="c-code__line"></div><div class="c-code__line">            Initialize(dataFile, Console.Out);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> Initialize(</div><div class="c-code__line">            <span class="c-code__keywordtype">string</span> dataFile, TextWriter output)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Initialize a service collection, which will be used to create the services</span></div><div class="c-code__line">            <span class="c-code__comment">// required by the Pipeline and manage their lifetimes.</span></div><div class="c-code__line">            <span class="c-code__keyword">using</span> (var serviceProvider = <span class="c-code__keyword">new</span> ServiceCollection()</div><div class="c-code__line">                <span class="c-code__comment">// Make sure we&#39;re logging to the console.</span></div><div class="c-code__line">                .AddLogging(l =&gt; l.AddConsole())</div><div class="c-code__line">                <span class="c-code__comment">// Add the builders we&#39;re going to need.</span></div><div class="c-code__line">                .AddTransient&lt;DeviceDetectionPipelineBuilder&gt;()</div><div class="c-code__line">                <span class="c-code__comment">// Add example classes.</span></div><div class="c-code__line">                .AddSingleton&lt;Example&gt;()</div><div class="c-code__line">                .BuildServiceProvider())</div><div class="c-code__line">            {</div><div class="c-code__line">                var example = serviceProvider.GetRequiredService&lt;Example&gt;();</div><div class="c-code__line">                example.Run(dataFile, ExampleUtils.EvidenceValues.Skip(2).Take(1), output);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
