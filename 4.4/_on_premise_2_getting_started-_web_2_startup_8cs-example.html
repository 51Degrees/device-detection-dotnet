<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection .NET: OnPremise/GettingStarted-Web/Startup.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Device Detection .NET
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">Device detection services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_on_premise_2_getting_started-_web_2_startup_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">OnPremise/GettingStarted-Web/Startup.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>The source code for this example is available in full on <a href="https://github.com/51Degrees/device-detection-dotnet/tree/master/Examples/OnPremise/GettingStarted-Web">GitHub</a>.</p>
<p>Required NuGet Dependencies:</p><ul>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/">Microsoft.AspNetCore.App</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.DeviceDetection/">FiftyOne.DeviceDetection</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.Pipeline.Web/">FiftyOne.Pipeline.Web</a></li>
</ul>
<h2>Overview</h2>
<p>The <code>UseFiftyOne</code> extension method is used to create a Pipeline instance from the configuration that is supplied. The <code>AddFiftyOne</code> extension method adds a <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware">middleware</a> component that will intercept requests and perform device detection. The results will be stored in the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httpcontext.items">HttpContext</a>. The middleware will also handle setting response headers (e.g. Accept-CH for User-Agent Client Hints) and serving requests for client-side JavaScript and JSON resources. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">services.AddFiftyOne(Configuration);</div><div class="c-code__line"></div><div class="c-code__line">app.UseFiftyOne();</div></div><p>The results of detection can be accessed by adding a dependency on IFlowDataProvider. This can then be used to interrogate the data. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var flowData = _provider.GetFlowData();</div><div class="c-code__line">var deviceData = flowData.Get&lt;IDeviceData&gt;();</div><div class="c-code__line">var hardwareVendor = deviceData.HardwareVendor;</div></div><p>Results can also be accessed in client-side code by using the <code>fod</code> object. See the <a href="https://51degrees.com/pipeline-dotnet/class_fifty_one_1_1_pipeline_1_1_java_script_builder_1_1_flow_element_1_1_java_script_builder_element_builder.html">JavaScriptBuilderElementBuilder</a> for details on available settings such as changing the <code>fod</code> name. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">window.onload = function () {</div><div class="c-code__line">    fod.complete(function(data) {</div><div class="c-code__line">        var hardwareName = data.device.hardwarename;</div><div class="c-code__line">        alert(hardwareName.join(&quot;, &quot;));</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><h2>Configuration</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;Logging&quot;: {</div><div class="c-code__line">    &quot;LogLevel&quot;: {</div><div class="c-code__line">      &quot;Default&quot;: &quot;Information&quot;,</div><div class="c-code__line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</div><div class="c-code__line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  },</div><div class="c-code__line">  &quot;AllowedHosts&quot;: &quot;*&quot;,</div><div class="c-code__line">  // For a sample configuration file demonstrating all available options, see </div><div class="c-code__line">  // https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/sample-configuration.json</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        // Required to unpack the GetHighEntropyValues base 64 encoded string into UACH HTTP headers.</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;UachJsConversionElement&quot;</div><div class="c-code__line">      },</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;51Degrees-LiteV4.1.hash&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: false,</div><div class="c-code__line">          &quot;AutoUpdate&quot;: false,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;,</div><div class="c-code__line">          &quot;DataFileSystemWatcher&quot;: false,</div><div class="c-code__line">          &quot;DataUpdateOnStartUp&quot;: false,</div><div class="c-code__line">          // Explicitly include just the properties used by the example.</div><div class="c-code__line">          &quot;Properties&quot;: &quot;DeviceId,JavascriptHardwareProfile,HardwareVendor,HardwareModel,HardwareName,IsMobile,JavascriptGetHighEntropyValues,Promise,Fetch,DeviceType,PlatformVendor,PlatformName,PlatformVersion,BrowserVendor,BrowserName,BrowserVersion,ScreenPixelsWidth,ScreenPixelsHeight,ScreenPixelsWidthJavascript,ScreenPixelsHeightJavascript&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      },</div><div class="c-code__line">      {</div><div class="c-code__line">        // Required to add Javascript and JSON end points for 51Degrees.core.js and </div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;JavaScriptBuilderElement&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;Minify&quot;: true</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ],</div><div class="c-code__line">    // Both these options default to true anyway.</div><div class="c-code__line">    // They are specified here for illustrative purposes.</div><div class="c-code__line">    &quot;ClientSideEvidenceEnabled&quot;: true,</div><div class="c-code__line">    &quot;UseAsyncScript&quot;: true</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><h2>Controller</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Mvc;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Web.Services;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples.html">Examples</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise.html">OnPremise</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_getting_started_web.html">GettingStartedWeb</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_getting_started_web_1_1_model.html">Model</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_getting_started_web_1_1_controllers.html">FiftyOne.DeviceDetection.Examples.OnPremise.GettingStartedWeb.Controllers</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>HomeController : Controller</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">bool</span> _checkedDataFile = <span class="c-code__keyword">false</span>;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> IFlowDataProvider _provider;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> ILogger&lt;HomeController&gt; _logger;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// The controller has a dependency on IFlowDataProvider. This is used to access the </span></div><div class="c-code__line">        <span class="c-code__comment">// IFlowData that contains the device detection results for the current HTTP request.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> HomeController(IFlowDataProvider provider, ILogger&lt;HomeController&gt; logger)</div><div class="c-code__line">        {</div><div class="c-code__line">            _provider = provider;</div><div class="c-code__line">            _logger = logger;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IActionResult Index()</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Log warnings if the data file is too old or the &#39;Lite&#39; file is being used.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span>(_checkedDataFile == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                ExampleUtils.CheckDataFile(_provider.GetFlowData().Pipeline, _logger);</div><div class="c-code__line">                _checkedDataFile = <span class="c-code__keyword">true</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__comment">// Use the provider to get the flow data. This contains the results of device</span></div><div class="c-code__line">            <span class="c-code__comment">// detection that has been performed by the pipeline.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> View(<span class="c-code__keyword">new</span> IndexModel(_provider.GetFlowData(), Response.Headers));</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><h2>View</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">@* *********************************************************************</div><div class="c-code__line"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</div><div class="c-code__line"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</div><div class="c-code__line"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</div><div class="c-code__line"> *</div><div class="c-code__line"> * This Original Work is licensed under the European Union Public Licence</div><div class="c-code__line"> * (EUPL) v.1.2 and is subject to its terms as set out below.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If a copy of the EUPL was not distributed with this file, You can obtain</div><div class="c-code__line"> * one at https://opensource.org/licenses/EUPL-1.2.</div><div class="c-code__line"> *</div><div class="c-code__line"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</div><div class="c-code__line"> * amended by the European Commission) shall be deemed incompatible for</div><div class="c-code__line"> * the purposes of the Work and the provisions of the compatibility</div><div class="c-code__line"> * clause in Article 5 of the EUPL shall not apply.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If using the Work as, or as part of, a network application, by</div><div class="c-code__line"> * including the attribution notice(s) required under Article 5 of the EUPL</div><div class="c-code__line"> * in the end user terms of the application under an appropriate heading,</div><div class="c-code__line"> * such notice(s) shall fulfill the requirements of that article.</div><div class="c-code__line"> * ********************************************************************* *@</div><div class="c-code__line"></div><div class="c-code__line">@using FiftyOne.DeviceDetection.Examples </div><div class="c-code__line">@model FiftyOne.DeviceDetection.Examples.OnPremise.GettingStartedWeb.Model.IndexModel</div><div class="c-code__line">@{</div><div class="c-code__line">    ViewData[&quot;Title&quot;] = &quot;Web Integration Example&quot;;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;h2&gt;Web Integration Example&lt;/h2&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    This example demonstrates the use of the Pipeline API to perform device detection within a</div><div class="c-code__line">    simple ASP.NET Core web project. In particular, it highlights:</div><div class="c-code__line">    &lt;ol&gt;</div><div class="c-code__line">        &lt;li&gt;</div><div class="c-code__line">            Automatic handling of the &#39;Accept-CH&#39; header, which is used to request User-Agent</div><div class="c-code__line">            Client Hints from the browser</div><div class="c-code__line">        &lt;/li&gt;</div><div class="c-code__line">        &lt;li&gt;</div><div class="c-code__line">            Client-side evidence collection in order to identify Apple device models and properties</div><div class="c-code__line">            such as screen size.</div><div class="c-code__line">        &lt;/li&gt;</div><div class="c-code__line">    &lt;/ol&gt;</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line">&lt;h3&gt;Client Hints&lt;/h3&gt;</div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    When the first request is made, browsers that support client hints will typically send a subset</div><div class="c-code__line">    of client hints values along with the User-Agent header.</div><div class="c-code__line">    If device detection determines that the browser does support client hints then it will request</div><div class="c-code__line">    that additional client hints headers are sent with future requests by sending the Accept-CH</div><div class="c-code__line">    header with the response.</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    Note that if you have visited this page previously, the value of Accept-CH will have been</div><div class="c-code__line">    cached so all requested client hints headers will be sent on the first request. Using features</div><div class="c-code__line">    such as &#39;private browsing&#39; or &#39;incognito mode&#39; will allow you to see the true first request</div><div class="c-code__line">    experience as the previous Accept-CH value will not be used.</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;noscript&gt;</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: JavaScript is disabled in your browser. This means that the callback discussed</div><div class="c-code__line">        further down this page will not fire and UACH headers will not be sent.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">&lt;/noscript&gt;</div><div class="c-code__line">@if (DateTime.UtcNow &gt; Model.DataFile.DataPublishedDateTime</div><div class="c-code__line">    .AddDays(ExampleUtils.DataFileAgeWarning))</div><div class="c-code__line">{</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: This example is using a data file that is more than </div><div class="c-code__line">        @ExampleUtils.DataFileAgeWarning days old. A more recent data file may be needed to </div><div class="c-code__line">        correctly detect the latest devices, browsers, etc. The latest lite data file is available </div><div class="c-code__line">        from the </div><div class="c-code__line">        &lt;a href=&quot;https://github.com/51Degrees/device-detection-data&quot;&gt;device-detection-data&lt;/a&gt;</div><div class="c-code__line">        repository on GitHub. Find out about the Enterprise data file, which includes automatic </div><div class="c-code__line">        daily updates, on our &lt;a href=&quot;https://51degrees.com/pricing&quot;&gt;pricing page&lt;/a&gt;.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;div id=&quot;content&quot;&gt;</div><div class="c-code__line">    &lt;h3&gt;Detection results&lt;/h3&gt;</div><div class="c-code__line">    &lt;p&gt;</div><div class="c-code__line">        The following values are determined by sever-side device detection</div><div class="c-code__line">        on the first request:</div><div class="c-code__line">    &lt;/p&gt;</div><div class="c-code__line">    &lt;table&gt;</div><div class="c-code__line">        &lt;tr&gt;</div><div class="c-code__line">            &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">            &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">        &lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Hardware Vendor:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.HardwareVendor&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Hardware Name:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.HardwareName&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Device Type:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.DeviceType&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Platform Vendor:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.PlatformVendor&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Platform Name:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.PlatformName&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Platform Version:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.PlatformVersion&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Browser Vendor:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.BrowserVendor&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Browser Name:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.BrowserName&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Browser Version:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.BrowserVersion&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Screen width (pixels):&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.ScreenWidth&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Screen height (pixels):&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.ScreenHeight&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Device Id:&lt;/b&gt;&lt;/td&gt;&lt;td&gt; @Model.DeviceId&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">    &lt;/table&gt;</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;div id=&quot;evidence&quot;&gt;</div><div class="c-code__line">        &lt;h3&gt;Evidence used&lt;/h3&gt;</div><div class="c-code__line">        &lt;p class=&quot;smaller&quot;&gt;Evidence was &lt;span class=&quot;lightgreen&quot;&gt;used&lt;/span&gt; / &lt;span class=&quot;lightyellow&quot;&gt;present&lt;/span&gt; for detection&lt;/p&gt;</div><div class="c-code__line">        &lt;table&gt;</div><div class="c-code__line">            &lt;tr&gt;</div><div class="c-code__line">                &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">                &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            @foreach (var entry in Model.Evidence)</div><div class="c-code__line">            {</div><div class="c-code__line">                &lt;tr class=&quot;@(entry.Used ? &quot;lightgreen&quot; : &quot;lightyellow&quot;)&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;@(entry.Key)&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(entry.Value)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">        &lt;/table&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;div id=&quot;response-headers&quot;&gt;</div><div class="c-code__line">        &lt;h3&gt;Response headers&lt;/h3&gt;</div><div class="c-code__line">        &lt;table&gt;</div><div class="c-code__line">            &lt;tr&gt;</div><div class="c-code__line">                &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">                &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            @foreach (var entry in Model.ResponseHeaders)</div><div class="c-code__line">            {</div><div class="c-code__line">            &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                &lt;td&gt;&lt;b&gt;@(entry.Key)&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                &lt;td&gt;@(entry.Value)&lt;/td&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">        &lt;/table&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line"></div><div class="c-code__line">    @if (Model.ResponseHeaders.ContainsKey(&quot;Accept-CH&quot;) == false)</div><div class="c-code__line">    {</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: There is no Accept-CH header in the response. This may indicate that your</div><div class="c-code__line">        browser does not support User-Agent Client Hints. This is not necessarily a problem,</div><div class="c-code__line">        but if you are wanting to try out detection using User-Agent Client Hints, then make</div><div class="c-code__line">        sure that your browser</div><div class="c-code__line">        &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/User-Agent_Client_Hints_API#browser_compatibility&quot;&gt;supports them&lt;/a&gt;.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    }</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;h3&gt;Client-side Evidence and Apple Models&lt;/h3&gt;</div><div class="c-code__line">    &lt;p&gt;</div><div class="c-code__line">        The information shown below is determined after a callback is made to the server with</div><div class="c-code__line">        additional evidence that is gathered by JavaScript running on the client-side.</div><div class="c-code__line">        The callback will also include any additional client hints headers that have been requested.</div><div class="c-code__line">    &lt;/p&gt;</div><div class="c-code__line">    &lt;p&gt;</div><div class="c-code__line">        When an Apple device is used, the results from</div><div class="c-code__line">        the first request above will show all Apple models because the server cannot tell the</div><div class="c-code__line">        exact model of the device. In contrast, the results from the callback below will show</div><div class="c-code__line">        a smaller set of possible models.</div><div class="c-code__line">        This can be tested to some extent using most emulators, such as those in the</div><div class="c-code__line">        &#39;developer tools&#39; menu in Google Chrome. However, these are not the identical to real</div><div class="c-code__line">        devices so this can cause some unusual results. Using real devices will generally be more</div><div class="c-code__line">        successful.</div><div class="c-code__line">    &lt;/p&gt;</div><div class="c-code__line">    &lt;p&gt;</div><div class="c-code__line">        If you want to work with Apple Model or other client-side information, such as screen</div><div class="c-code__line">        width/height on the server, it will be available on the next request.</div><div class="c-code__line">        This is achieved by storing the additional client-side evidence as cookies on the client.</div><div class="c-code__line">        When a future page is requested, these cookies will be included with the request and the</div><div class="c-code__line">        device detection API will include them when working out the details of the device.</div><div class="c-code__line">        Refreshing this page can be used to show this in action. Any values that are unique to the</div><div class="c-code__line">        client-side values below will appear in the evidence values used and server-side results</div><div class="c-code__line">        after the refresh.</div><div class="c-code__line">    &lt;/p&gt;</div><div class="c-code__line">    @if (Model.Engine.DataSourceTier == &quot;Lite&quot;)</div><div class="c-code__line">    {</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: You are using the free &#39;Lite&#39; data file. This does not include the client-side</div><div class="c-code__line">        evidence capabilities of the paid-for data file, so you will not see any additional</div><div class="c-code__line">        data below. Find out about the Enterprise data file on our</div><div class="c-code__line">        &lt;a href=&quot;https://51degrees.com/pricing&quot;&gt;pricing page&lt;/a&gt;.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    }</div><div class="c-code__line">&lt;/div&gt;</div><div class="c-code__line"></div><div class="c-code__line">@* This View Component is embedded within the FiftyOne.Pipeline.Web package.</div><div class="c-code__line">    it adds a JavaScript include for 51Degrees.core.js.</div><div class="c-code__line">    The FiftyOne degrees middleware will intercept the request for this file and serve dynamically</div><div class="c-code__line">    generated JavaScript, which includes a JSON representation of the contents of flow data.</div><div class="c-code__line">    i.e. The results from device detection.</div><div class="c-code__line"></div><div class="c-code__line">    In addition, this JavaScript will look for properties that have a flag set indicating that</div><div class="c-code__line">    they contain executable script snippets.</div><div class="c-code__line">    These snippets will be executed and the values they obtain will be sent back to the server</div><div class="c-code__line">    in order for it to perform the detection process again with the new information.</div><div class="c-code__line">    This callback will also include any User-Agent Client Hints headers that have been requested</div><div class="c-code__line">    with the &#39;Accept-CH&#39; header. (assuming the browser is willing to send them)</div><div class="c-code__line"></div><div class="c-code__line">    When the server responds, the JSON representation of the results will be updated with the</div><div class="c-code__line">    new values and the &#39;complete&#39; event will fire.</div><div class="c-code__line">    Below, we subscribe to this complete event and display the values from the updated JSON.</div><div class="c-code__line">*@</div><div class="c-code__line">@await Component.InvokeAsync(&quot;FiftyOneJS&quot;)</div><div class="c-code__line"></div><div class="c-code__line">&lt;script&gt;</div><div class="c-code__line">    window.onload = function () {</div><div class="c-code__line">        // Subscribe to the &#39;complete&#39; event.</div><div class="c-code__line">        fod.complete(function (data) {</div><div class="c-code__line">            // When the event fires, use the supplied data to populate a new table.</div><div class="c-code__line">            let fieldValues = [];</div><div class="c-code__line"></div><div class="c-code__line">            var hardwareName = typeof data.device.hardwarename == &quot;undefined&quot; ?</div><div class="c-code__line">                &quot;Unknown&quot; : data.device.hardwarename.join(&quot;, &quot;)</div><div class="c-code__line">            fieldValues.push([&quot;Hardware Name: &quot;, hardwareName]);</div><div class="c-code__line">            fieldValues.push([&quot;Platform: &quot;,</div><div class="c-code__line">                data.device.platformname + &quot; &quot; + data.device.platformversion]);</div><div class="c-code__line">            fieldValues.push([&quot;Browser: &quot;,</div><div class="c-code__line">                data.device.browsername + &quot; &quot; + data.device.browserversion]);</div><div class="c-code__line">            fieldValues.push([&quot;Screen width (pixels): &quot;, data.device.screenpixelswidth]);</div><div class="c-code__line">            fieldValues.push([&quot;Screen height (pixels): &quot;, data.device.screenpixelsheight]);</div><div class="c-code__line">            displayValues(fieldValues);</div><div class="c-code__line">        });</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    // Helper function to add a table that displays the supplied values.</div><div class="c-code__line">    function displayValues(fieldValues) {</div><div class="c-code__line">        var table = document.createElement(&quot;table&quot;);</div><div class="c-code__line">        var tr = document.createElement(&quot;tr&quot;);</div><div class="c-code__line">        addToRow(tr, &quot;th&quot;, &quot;Key&quot;, false);</div><div class="c-code__line">        addToRow(tr, &quot;th&quot;, &quot;Value&quot;, false);</div><div class="c-code__line">        table.appendChild(tr);</div><div class="c-code__line"></div><div class="c-code__line">        fieldValues.forEach(function (entry) {</div><div class="c-code__line">            var tr = document.createElement(&quot;tr&quot;);</div><div class="c-code__line">            tr.classList.add(&quot;lightyellow&quot;);</div><div class="c-code__line">            addToRow(tr, &quot;td&quot;, entry[0], true);</div><div class="c-code__line">            addToRow(tr, &quot;td&quot;, entry[1], false);</div><div class="c-code__line">            table.appendChild(tr);</div><div class="c-code__line">        });</div><div class="c-code__line"></div><div class="c-code__line">        var element = document.getElementById(&quot;content&quot;);</div><div class="c-code__line">        element.appendChild(table);</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    // Helper function to add an entry to a table row.</div><div class="c-code__line">    function addToRow(row, elementName, text, strong) {</div><div class="c-code__line">        var entry = document.createElement(elementName);</div><div class="c-code__line">        var textNode = document.createTextNode(text);</div><div class="c-code__line">        if (strong === true) {</div><div class="c-code__line">            var strongNode = document.createElement(&quot;strong&quot;);</div><div class="c-code__line">            strongNode.appendChild(textNode);</div><div class="c-code__line">            textNode = strongNode;</div><div class="c-code__line">        }</div><div class="c-code__line">        entry.appendChild(textNode);</div><div class="c-code__line">        row.appendChild(entry);</div><div class="c-code__line">    }</div><div class="c-code__line">&lt;/script&gt;</div></div><h2>Startup</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Hash.Engine.OnPremise.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Uach;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Builder;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Hosting;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Threading.Tasks;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples_1_1_on_premise_1_1_getting_started_web.html">FiftyOne.DeviceDetection.Examples.OnPremise.GettingStartedWeb</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Startup</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> Startup(IConfiguration configuration)</div><div class="c-code__line">        {</div><div class="c-code__line">            Configuration = configuration;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IConfiguration Configuration { <span class="c-code__keyword">get</span>; }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to add services to the container.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> ConfigureServices(IServiceCollection services)</div><div class="c-code__line">        {</div><div class="c-code__line">            services.AddControllersWithViews();</div><div class="c-code__line"></div><div class="c-code__line">            services.Configure&lt;CookiePolicyOptions&gt;(options =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// This lambda determines whether user consent for non-essential cookies is needed</span></div><div class="c-code__line">                <span class="c-code__comment">// for a given request.</span></div><div class="c-code__line">                options.CheckConsentNeeded = context =&gt; <span class="c-code__keyword">true</span>;</div><div class="c-code__line">                options.MinimumSameSitePolicy = SameSiteMode.None;</div><div class="c-code__line">            });</div><div class="c-code__line"></div><div class="c-code__line">            services.AddMvc();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the hash engine builder to services so that the system can find the builder</span></div><div class="c-code__line">            <span class="c-code__comment">// when it needs to.</span></div><div class="c-code__line">            services.AddSingleton&lt;DeviceDetectionHashEngineBuilder&gt;();</div><div class="c-code__line">            services.AddSingleton&lt;UachJsConversionElementBuilder&gt;();</div><div class="c-code__line">            <span class="c-code__comment">// Configure the services needed by device detection and create the 51Degrees Pipeline</span></div><div class="c-code__line">            <span class="c-code__comment">// instance that will be used to process requests.</span></div><div class="c-code__line">            services.AddFiftyOne(Configuration);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to configure the HTTP request</span></div><div class="c-code__line">        <span class="c-code__comment">// pipeline.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)</div><div class="c-code__line">        {</div><div class="c-code__line">            app.UseDeveloperExceptionPage();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// This is only needed when running under an ASP.NET test server.</span></div><div class="c-code__line">            app.UseMiddleware&lt;UserAgentCorrectionMiddleware&gt;();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the 51Degrees middleware component.</span></div><div class="c-code__line">            <span class="c-code__comment">// This will pass any incoming requests through the pipeline API, performing device</span></div><div class="c-code__line">            <span class="c-code__comment">// detection. The IFlowData that is used will be stored in the data associated with </span></div><div class="c-code__line">            <span class="c-code__comment">// the current HTTP session.</span></div><div class="c-code__line">            <span class="c-code__comment">// The IFlowDataAccessor provides an easy way to retrieve this data. See HomeController</span></div><div class="c-code__line">            <span class="c-code__comment">// for an example of this.</span></div><div class="c-code__line">            app.UseFiftyOne();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseStaticFiles();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseRouting();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseAuthorization();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseEndpoints(endpoints =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                endpoints.MapControllerRoute(</div><div class="c-code__line">                    name: <span class="c-code__stringliteral">&quot;default&quot;</span>,</div><div class="c-code__line">                    pattern: <span class="c-code__stringliteral">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span>);</div><div class="c-code__line">            });</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">class </span>UserAgentCorrectionMiddleware</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">private</span> readonly RequestDelegate next;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> UserAgentCorrectionMiddleware(RequestDelegate next)</div><div class="c-code__line">            {</div><div class="c-code__line">                this.next = next;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> async Task Invoke(HttpContext httpContext)</div><div class="c-code__line">            {</div><div class="c-code__line">                var val = httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>];</div><div class="c-code__line">                httpContext.Request.Headers.Remove(<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>);</div><div class="c-code__line">                httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>] =</div><div class="c-code__line">                    <span class="c-code__keyword">new</span> Microsoft.Extensions.Primitives.StringValues(<span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot; &quot;</span>, val));</div><div class="c-code__line">                await this.next(httpContext);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
