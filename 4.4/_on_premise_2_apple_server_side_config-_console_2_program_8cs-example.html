<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection .NET: OnPremise/AppleServerSideConfig-Console/Program.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees Device Detection .NET
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">Device detection services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_on_premise_2_apple_server_side_config-_console_2_program_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">OnPremise/AppleServerSideConfig-Console/Program.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>Detection of the specific models of Apple devices being used to make a request is <a href="https://51degrees.com/documentation/4.4/_device_detection__features__apple_detection.html">more difficult</a> than it is for other vendors.Typically, the 51Degrees approach is to use dynamically generated JavaScript to determine the model on the client-side and pass this back to the server. Some users are unable or unwilling to deploy dynamic JavaScript. In this case 51Degrees have an alternative approach in which the required data is gathered using static JavaScript. This is then passed to the server to determine the Apple model.</p>
<p>This example demonstrates this alternative approach.</p>
<p>This example is available in full on <a href="https://github.com/51Degrees/device-detection-dotnet-examples/blob/master/Examples/OnPremise/AppleServerSide-Console/Program.cs">GitHub</a>.</p>
<p>This example requires a paid-for data file as the device model properties are not available in the free, 'lite' data file. See our <a href="https://51degrees.com/pricing">pricing page</a> for details on how to obtain one.</p>
<p>This variation shows how to create the pipeline from a configuration file: </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;Logging&quot;: {</div><div class="c-code__line">    &quot;LogLevel&quot;: {</div><div class="c-code__line">      &quot;Default&quot;: &quot;Information&quot;,</div><div class="c-code__line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</div><div class="c-code__line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  },</div><div class="c-code__line">  // For a sample configuration file demonstrating all available options, see </div><div class="c-code__line">  // https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/sample-configuration.json</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;AppleProfileEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;macintosh.data.json&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: false,</div><div class="c-code__line">          &quot;AutoUpdate&quot;: true,</div><div class="c-code__line">          &quot;DataFileSystemWatcher&quot;: false,</div><div class="c-code__line">          &quot;DataUpdateOnStartUp&quot;: true,</div><div class="c-code__line">          &quot;DataUpdateUrl&quot;: &quot;https://cloud.51degrees.com/cdn/macintosh.data.json&quot;,</div><div class="c-code__line">          &quot;UpdatePollingInterval&quot;: &quot;86400&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      },</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;DeviceDetectionHashEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;Enterprise-HashV41.hash&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: false,</div><div class="c-code__line">          &quot;AutoUpdate&quot;: false,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;LowMemory&quot;,</div><div class="c-code__line">          &quot;DataFileSystemWatcher&quot;: false,</div><div class="c-code__line">          &quot;DataUpdateOnStartUp&quot;: false</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ]</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><p>Required NuGet Dependencies:</p><ul>
<li><a class="el" href="namespace_fifty_one_1_1_device_detection.html">FiftyOne.DeviceDetection</a></li>
<li>Microsoft.Extensions.DependencyInjection</li>
<li>Microsoft.Extensions.Logging.Console</li>
<li>Microsoft.Extensions.Configuration.Json </li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples.html">Examples</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Hash.Engine.OnPremise.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.Services;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Collections.Generic;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.IO;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Net.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Text;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Constants = <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection_1_1_examples.html">Examples</a>.<a class="code" href="class_fifty_one_1_1_device_detection_1_1_examples_1_1_constants.html">Constants</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_apple_server_side___console.html">AppleServerSide_Console</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">class </span>Program</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Example : AppleExampleBase</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">private</span> IPipeline _pipeline;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <a name="a0"></a><a class="code" href="class_apple_server_side___console_1_1_program_1_1_example.html#a19127b4cca669b6f60769eb2b1bef285">Example</a>(IPipeline pipeline)</div><div class="c-code__line">            {</div><div class="c-code__line">                _pipeline = pipeline;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Run(TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Set the evidence values that we&#39;re going to pass in for this example.</span></div><div class="c-code__line">                <span class="c-code__comment">// In the real world, you will need to use JavaScript to get the values and pass</span></div><div class="c-code__line">                <span class="c-code__comment">// them back to the server to be added as evidence.</span></div><div class="c-code__line">                <span class="c-code__comment">// The script at https://cloud.51degrees.com/cdn/apple-functions.js contains the</span></div><div class="c-code__line">                <span class="c-code__comment">// raw functions that are used to obtain these values.</span></div><div class="c-code__line">                var data = <span class="c-code__keyword">new</span> List&lt;Dictionary&lt;string, object&gt;&gt;()</div><div class="c-code__line">                {</div><div class="c-code__line">                    <span class="c-code__keyword">new</span> Dictionary&lt;string, object&gt;() </div><div class="c-code__line">                    {</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Constants.EVIDENCE_HEADER_USERAGENT_KEY,</div><div class="c-code__line">                            <span class="c-code__stringliteral">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 Mobile/15E148 Safari/604.1&quot;</span> },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_SCREEN_HEIGHT_KEY, 1792 },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_SCREEN_WIDTH_KEY, 828 },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_SCREEN_RATIO_KEY, 2 },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_SCREEN_GAMUT_KEY, <span class="c-code__stringliteral">&quot;p3&quot;</span> },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_HASH3D_KEY, 3335845976 },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_HASH_KEY, 2206992415 },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_RENDERER_KEY, <span class="c-code__stringliteral">&quot;Apple GPU&quot;</span> },</div><div class="c-code__line">                        { <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_device_detection.html">DeviceDetection</a>.Apple.Constants.EVIDENCE_FAMILY_KEY, <span class="c-code__stringliteral">&quot;iPhone&quot;</span> }</div><div class="c-code__line">                    }</div><div class="c-code__line">                };</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// carry out some sample detections</span></div><div class="c-code__line">                <span class="c-code__keywordflow">foreach</span> (var values <span class="c-code__keywordflow">in</span> data)</div><div class="c-code__line">                {</div><div class="c-code__line">                    AnalyseEvidence(values, output);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> AnalyseEvidence(</div><div class="c-code__line">                Dictionary&lt;string, object&gt; evidence,</div><div class="c-code__line">                TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// FlowData is a data structure that is used to convey information required for</span></div><div class="c-code__line">                <span class="c-code__comment">// detection and the results of the detection through the pipeline.</span></div><div class="c-code__line">                <span class="c-code__comment">// Information required for detection is called &quot;evidence&quot; and usually consists</span></div><div class="c-code__line">                <span class="c-code__comment">// of a number of HTTP Header field values, in this case represented by a</span></div><div class="c-code__line">                <span class="c-code__comment">// Dictionary&lt;string, object&gt; of header name/value entries.</span></div><div class="c-code__line">                <span class="c-code__comment">//</span></div><div class="c-code__line">                <span class="c-code__comment">// FlowData is wrapped in a using block in order to ensure that the unmanaged</span></div><div class="c-code__line">                <span class="c-code__comment">// resources allocated by the native device detection library are freed</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var data = _pipeline.CreateFlowData())</div><div class="c-code__line">                {</div><div class="c-code__line">                    StringBuilder message = <span class="c-code__keyword">new</span> StringBuilder();</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// list the evidence</span></div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;Input values:&quot;</span>);</div><div class="c-code__line">                    <span class="c-code__keywordflow">foreach</span> (var entry <span class="c-code__keywordflow">in</span> evidence)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        message.AppendLine($<span class="c-code__stringliteral">&quot;\t{entry.Key}: {entry.Value}&quot;</span>);</div><div class="c-code__line">                    }</div><div class="c-code__line">                    output.WriteLine(message.ToString());</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// Add the evidence values to the flow data</span></div><div class="c-code__line">                    data.AddEvidence(evidence);</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// Process the flow data.</span></div><div class="c-code__line">                    data.Process();</div><div class="c-code__line"></div><div class="c-code__line">                    message = <span class="c-code__keyword">new</span> StringBuilder();</div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;Results:&quot;</span>);</div><div class="c-code__line">                    var device = data.Get&lt;IDeviceData&gt;();</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// Display the model name(s) of the devices matching the supplied evidence.</span></div><div class="c-code__line">                    OutputValue(<span class="c-code__stringliteral">&quot;Model Name(s)&quot;</span>, device.HardwareName, message);</div><div class="c-code__line">                    output.WriteLine(message.ToString());</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputValue(<span class="c-code__keywordtype">string</span> name,</div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;string&gt;&gt; value,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                message.AppendLine(value.HasValue ?</div><div class="c-code__line">                    $<span class="c-code__stringliteral">&quot;\t{name}: &quot;</span> + <span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot;, &quot;</span>, value.Value) :</div><div class="c-code__line">                    $<span class="c-code__stringliteral">&quot;\t{name}: &quot;</span> + value.NoValueMessage);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> Run(PipelineOptions options, TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Initialize a service collection which will be used to create the services</span></div><div class="c-code__line">                <span class="c-code__comment">// required by the Pipeline and manage their lifetimes.</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var serviceProvider = <span class="c-code__keyword">new</span> ServiceCollection()</div><div class="c-code__line">                    <span class="c-code__comment">// Add the configuration to the services collection</span></div><div class="c-code__line">                    <span class="c-code__comment">// Make sure we&#39;re logging to the console.</span></div><div class="c-code__line">                    .AddLogging(l =&gt; l.AddConsole())</div><div class="c-code__line">                    <span class="c-code__comment">// Add the configuration to the services collection.</span></div><div class="c-code__line">                    <span class="c-code__comment">// Add an HttpClient instance. This is used for making requests to the</span></div><div class="c-code__line">                    <span class="c-code__comment">// data update end point.</span></div><div class="c-code__line">                    .AddSingleton&lt;HttpClient&gt;()</div><div class="c-code__line">                    <span class="c-code__comment">// We want to use the standard data update service</span></div><div class="c-code__line">                    .AddSingleton&lt;IDataUpdateService, DataUpdateService&gt;()</div><div class="c-code__line">                    .AddSingleton(options)</div><div class="c-code__line">                    .AddTransient&lt;AppleProfileEngineBuilder&gt;()</div><div class="c-code__line">                    .AddTransient&lt;DeviceDetectionHashEngineBuilder&gt;()</div><div class="c-code__line">                    .AddTransient&lt;PipelineBuilder&gt;()</div><div class="c-code__line">                    <span class="c-code__comment">// Add a factory to create the singleton IPipeline instance</span></div><div class="c-code__line">                    .AddSingleton((x) =&gt;</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__comment">// Build the pipeline</span></div><div class="c-code__line">                        <span class="c-code__keywordflow">return</span> x.GetRequiredService&lt;PipelineBuilder&gt;()</div><div class="c-code__line">                            .BuildFromConfiguration(x.GetRequiredService&lt;PipelineOptions&gt;());</div><div class="c-code__line">                    })</div><div class="c-code__line">                    .AddTransient&lt;Example&gt;()</div><div class="c-code__line">                    .BuildServiceProvider())</div><div class="c-code__line">                {</div><div class="c-code__line">                    var engine = serviceProvider.GetRequiredService&lt;IPipeline&gt;()</div><div class="c-code__line">                        .GetElement&lt;DeviceDetectionHashEngine&gt;();</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// If we&#39;ve passed all the checks then run the example.</span></div><div class="c-code__line">                    <span class="c-code__keywordflow">if</span> (CheckDataFiles(</div><div class="c-code__line">                        serviceProvider.GetRequiredService&lt;ILogger&lt;Program&gt;&gt;(),</div><div class="c-code__line">                        engine,</div><div class="c-code__line">                        options.GetHashDataFile(),</div><div class="c-code__line">                        options.GetAppleDataFile()))</div><div class="c-code__line">                    {</div><div class="c-code__line">                        serviceProvider.GetRequiredService&lt;<a class="code" href="class_apple_server_side___console_1_1_program_1_1_example.html#a19127b4cca669b6f60769eb2b1bef285">Example</a>&gt;().Run(output);</div><div class="c-code__line">                    }</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> Main(<span class="c-code__keywordtype">string</span>[] args)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Load the configuration file</span></div><div class="c-code__line">            var config = <span class="c-code__keyword">new</span> ConfigurationBuilder()</div><div class="c-code__line">                .AddJsonFile(<span class="c-code__stringliteral">&quot;appsettings.json&quot;</span>)</div><div class="c-code__line">                .Build();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Bind the configuration to a pipeline options instance</span></div><div class="c-code__line">            PipelineOptions options = <span class="c-code__keyword">new</span> PipelineOptions();</div><div class="c-code__line">            var section = config.GetRequiredSection(<span class="c-code__stringliteral">&quot;PipelineOptions&quot;</span>);</div><div class="c-code__line">            <span class="c-code__comment">// Use the &#39;ErrorOnUnknownConfiguration&#39; option to warn us if we&#39;ve got any</span></div><div class="c-code__line">            <span class="c-code__comment">// misnamed configuration keys.</span></div><div class="c-code__line">            section.Bind(options, (o) =&gt; { o.ErrorOnUnknownConfiguration = <span class="c-code__keyword">true</span>; });</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Get the hash data file setting from the config file. </span></div><div class="c-code__line">            var hashFileFromConfig = options.GetHashDataFile();</div><div class="c-code__line">            <span class="c-code__comment">// Make sure we&#39;ve got a complete path to the data file, then update the configuration.</span></div><div class="c-code__line">            options.SetHashDataFile(GetCompleteFilename(hashFileFromConfig, </div><div class="c-code__line">                Constants.ENTERPRISE_HASH_DATA_FILE_NAME));</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Get the Apple data file setting from the config file. </span></div><div class="c-code__line">            var appleFileFromConfig = options.GetAppleDataFile();</div><div class="c-code__line">            <span class="c-code__comment">// Make sure we&#39;ve got a complete path to the data file, then update the configuration.</span></div><div class="c-code__line">            options.SetAppleDataFile(GetCompleteFilename(appleFileFromConfig,</div><div class="c-code__line">                Constants.APPLE_DATA_FILE_NAME));</div><div class="c-code__line"></div><div class="c-code__line">            Example.Run(options, Console.Out);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">string</span> GetCompleteFilename(<span class="c-code__keywordtype">string</span> filenameFromConfig, <span class="c-code__keywordtype">string</span> defaultName)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// If no data file is specified in the config file, or we don&#39;t have a complete path,</span></div><div class="c-code__line">            <span class="c-code__comment">// then file the complete path and use it to override the one in the config file.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(filenameFromConfig))</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">return</span> ExampleUtils.FindFile(defaultName);</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__keywordflow">else</span> <span class="c-code__keywordflow">if</span> (Path.IsPathRooted(filenameFromConfig) == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">return</span> ExampleUtils.FindFile(filenameFromConfig);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> filenameFromConfig;</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
